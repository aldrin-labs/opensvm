<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover">
  <title>Offline - OpenSVM</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  
  <style>
    :root {
      --primary: 142.1 76.2% 36.3%;
      --primary-foreground: 355.7 100% 97.3%;
      --background: 0 0% 100%;
      --foreground: 240 10% 3.9%;
      --muted: 240 4.8% 95.9%;
      --muted-foreground: 240 3.8% 46.1%;
      --border: 240 5.9% 90%;
      --radius: 0.5rem;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --background: 240 10% 3.9%;
        --foreground: 0 0% 98%;
        --muted: 240 3.7% 15.9%;
        --muted-foreground: 240 5% 64.9%;
        --border: 240 3.7% 15.9%;
      }
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      text-align: center;
      max-width: 400px;
      padding: 2rem;
    }
    
    .icon {
      width: 80px;
      height: 80px;
      background: hsl(var(--muted));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      font-size: 2rem;
    }
    
    h1 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0 0 0.5rem;
      color: hsl(var(--foreground));
    }
    
    p {
      color: hsl(var(--muted-foreground));
      margin: 0 0 2rem;
      line-height: 1.6;
    }
    
    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: calc(var(--radius) - 2px);
      font-size: 0.875rem;
      font-weight: 500;
      height: 2.5rem;
      padding: 0 1rem;
      background: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border: none;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s ease;
      margin: 0 0.5rem;
    }
    
    .button:hover {
      opacity: 0.9;
    }
    
    .button-outline {
      background: transparent;
      color: hsl(var(--foreground));
      border: 1px solid hsl(var(--border));
    }
    
    .button-outline:hover {
      background: hsl(var(--muted));
      opacity: 1;
    }
    
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: hsl(var(--muted));
      border-radius: var(--radius);
      font-size: 0.875rem;
      margin: 1rem 0;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ef4444;
    }
    
    .status-dot.online {
      background: #22c55e;
    }
    
    .cached-data {
      background: hsl(var(--muted));
      border-radius: var(--radius);
      padding: 1rem;
      margin: 1.5rem 0;
      text-align: left;
    }
    
    .cached-data h3 {
      font-size: 0.875rem;
      font-weight: 600;
      margin: 0 0 0.5rem;
      color: hsl(var(--foreground));
    }
    
    .cached-data ul {
      margin: 0;
      padding: 0;
      list-style: none;
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
    }
    
    .cached-data li {
      padding: 0.25rem 0;
      border-bottom: 1px solid hsl(var(--border));
    }
    
    .cached-data li:last-child {
      border-bottom: none;
    }
    
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    
    .loading {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="icon" id="connectionIcon">
      ðŸ“¡
    </div>
    
    <h1>You're Offline</h1>
    <p>
      No internet connection detected. Some features may not be available, 
      but you can still access cached data and recently viewed content.
    </p>
    
    <div class="status-indicator">
      <span class="status-dot" id="statusDot"></span>
      <span id="statusText">Checking connection...</span>
    </div>
    
    <div class="cached-data" id="cachedData" style="display: none;">
      <h3>Available Offline</h3>
      <ul id="cachedList">
        <li>Recent search results</li>
        <li>Transaction history</li>
        <li>Account data</li>
        <li>Settings and preferences</li>
      </ul>
    </div>
    
    <div>
      <button class="button" onclick="tryReconnect()" id="reconnectBtn">
        <span id="reconnectText">Try Again</span>
      </button>
      <a href="/" class="button button-outline">
        Go to Home
      </a>
    </div>
  </div>
  
  <script>
    let isCheckingConnection = false;
    
    // Update connection status
    function updateStatus(online) {
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      const connectionIcon = document.getElementById('connectionIcon');
      const cachedData = document.getElementById('cachedData');
      const reconnectBtn = document.getElementById('reconnectBtn');
      
      if (online) {
        statusDot.classList.add('online');
        statusText.textContent = 'Connection restored';
        connectionIcon.textContent = 'ðŸ“¡';
        cachedData.style.display = 'none';
        
        // Auto-redirect after showing success message
        setTimeout(() => {
          window.location.href = '/';
        }, 1500);
      } else {
        statusDot.classList.remove('online');
        statusText.textContent = 'No internet connection';
        connectionIcon.textContent = 'ðŸ“¡';
        cachedData.style.display = 'block';
      }
      
      reconnectBtn.disabled = false;
      reconnectBtn.querySelector('#reconnectText').textContent = 'Try Again';
      reconnectBtn.querySelector('#reconnectText').classList.remove('loading');
    }
    
    // Try to reconnect
    async function tryReconnect() {
      if (isCheckingConnection) return;
      
      isCheckingConnection = true;
      const reconnectBtn = document.getElementById('reconnectBtn');
      const reconnectText = document.getElementById('reconnectText');
      
      reconnectBtn.disabled = true;
      reconnectText.textContent = 'Checking...';
      reconnectText.classList.add('loading');
      
      try {
        // Try to fetch a small resource to test connection
        const response = await fetch('/favicon.svg', {
          method: 'HEAD',
          cache: 'no-cache'
        });
        
        if (response.ok) {
          updateStatus(true);
        } else {
          throw new Error('Connection test failed');
        }
      } catch (error) {
        updateStatus(false);
      } finally {
        isCheckingConnection = false;
      }
    }
    
    // Check cache storage
    async function checkCachedData() {
      try {
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          const cachedList = document.getElementById('cachedList');
          
          if (cacheNames.length > 0) {
            cachedList.innerHTML = '';
            
            // Add some example cached items
            const items = [
              'Recent search results',
              'Transaction history', 
              'Account data',
              'Settings and preferences',
              'Static assets'
            ];
            
            items.forEach(item => {
              const li = document.createElement('li');
              li.textContent = item;
              cachedList.appendChild(li);
            });
          }
        }
      } catch (error) {
        console.error('Failed to check cached data:', error);
      }
    }
    
    // Listen for online/offline events
    window.addEventListener('online', () => updateStatus(true));
    window.addEventListener('offline', () => updateStatus(false));
    
    // Listen for service worker messages
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.addEventListener('message', (event) => {
        const { data } = event;
        
        if (data.type === 'SYNC_COMPLETE') {
          // Show notification that data has been synced
          const statusText = document.getElementById('statusText');
          statusText.textContent = 'Data synchronized';
          
          setTimeout(() => {
            updateStatus(navigator.onLine);
          }, 2000);
        }
      });
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      updateStatus(navigator.onLine);
      checkCachedData();
      
      // Periodically check connection
      setInterval(() => {
        if (!navigator.onLine && !isCheckingConnection) {
          // Silent connection check every 30 seconds when offline
          fetch('/favicon.svg', { 
            method: 'HEAD', 
            cache: 'no-cache' 
          })
          .then(response => {
            if (response.ok && !navigator.onLine) {
              // Force online event if fetch succeeds but navigator.onLine is false
              updateStatus(true);
            }
          })
          .catch(() => {
            // Still offline, no action needed
          });
        }
      }, 30000);
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (event) => {
      if (event.key === 'r' && (event.metaKey || event.ctrlKey)) {
        event.preventDefault();
        tryReconnect();
      }
      
      if (event.key === 'h' && (event.metaKey || event.ctrlKey)) {
        event.preventDefault();
        window.location.href = '/';
      }
    });
  </script>
</body>
</html>